<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-05-18">
<meta name="description" content="CovidCAR is intended to facilitate Covid19 model building, ensembling, and evalutaion">

<title>A brief overview of the CovidCAR Package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="CovidCAR-introduction_files/libs/clipboard/clipboard.min.js"></script>
<script src="CovidCAR-introduction_files/libs/quarto-html/quarto.js"></script>
<script src="CovidCAR-introduction_files/libs/quarto-html/popper.min.js"></script>
<script src="CovidCAR-introduction_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="CovidCAR-introduction_files/libs/quarto-html/anchor.min.js"></script>
<link href="CovidCAR-introduction_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="CovidCAR-introduction_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="CovidCAR-introduction_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="CovidCAR-introduction_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="CovidCAR-introduction_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Page Contents</h2>
   
  <ul class="collapse">
  <li><a href="#tutorial-overview" id="toc-tutorial-overview" class="nav-link active" data-scroll-target="#tutorial-overview">Tutorial Overview</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries">Preliminaries</a></li>
  <li><a href="#setup-analysis" id="toc-setup-analysis" class="nav-link" data-scroll-target="#setup-analysis">Setup Analysis</a>
  <ul class="collapse">
  <li><a href="#specifiy-dates-and-directories" id="toc-specifiy-dates-and-directories" class="nav-link" data-scroll-target="#specifiy-dates-and-directories">Specifiy Dates and Directories</a></li>
  <li><a href="#define-spatial-domain" id="toc-define-spatial-domain" class="nav-link" data-scroll-target="#define-spatial-domain">Define Spatial Domain</a></li>
  <li><a href="#adjacency-graph" id="toc-adjacency-graph" class="nav-link" data-scroll-target="#adjacency-graph">Adjacency Graph</a></li>
  </ul></li>
  <li><a href="#retrieve-observation-data" id="toc-retrieve-observation-data" class="nav-link" data-scroll-target="#retrieve-observation-data">Retrieve Observation Data</a></li>
  <li><a href="#forecast-template" id="toc-forecast-template" class="nav-link" data-scroll-target="#forecast-template">Forecast Template</a></li>
  <li><a href="#additional-covariates" id="toc-additional-covariates" class="nav-link" data-scroll-target="#additional-covariates">Additional Covariates</a>
  <ul class="collapse">
  <li><a href="#demographic-data" id="toc-demographic-data" class="nav-link" data-scroll-target="#demographic-data">Demographic Data</a></li>
  <li><a href="#rt-estimation" id="toc-rt-estimation" class="nav-link" data-scroll-target="#rt-estimation">Rt Estimation</a></li>
  </ul></li>
  <li><a href="#organize-data" id="toc-organize-data" class="nav-link" data-scroll-target="#organize-data">Organize Data</a>
  <ul class="collapse">
  <li><a href="#clean-dataframe" id="toc-clean-dataframe" class="nav-link" data-scroll-target="#clean-dataframe">Clean Dataframe</a></li>
  <li><a href="#code-respone-variable" id="toc-code-respone-variable" class="nav-link" data-scroll-target="#code-respone-variable">Code Respone Variable</a></li>
  <li><a href="#format-as-a-datastack" id="toc-format-as-a-datastack" class="nav-link" data-scroll-target="#format-as-a-datastack">Format as a Datastack</a></li>
  </ul></li>
  <li><a href="#model-priors-and-forumulae" id="toc-model-priors-and-forumulae" class="nav-link" data-scroll-target="#model-priors-and-forumulae">Model Priors and Forumulae</a>
  <ul class="collapse">
  <li><a href="#set-priors" id="toc-set-priors" class="nav-link" data-scroll-target="#set-priors">Set Priors</a></li>
  <li><a href="#specify-formulas" id="toc-specify-formulas" class="nav-link" data-scroll-target="#specify-formulas">Specify Formulas</a></li>
  </ul></li>
  <li><a href="#run-models" id="toc-run-models" class="nav-link" data-scroll-target="#run-models">Run Models</a></li>
  <li><a href="#extract-and-format-forecasts" id="toc-extract-and-format-forecasts" class="nav-link" data-scroll-target="#extract-and-format-forecasts">Extract and Format Forecasts</a></li>
  <li><a href="#examine-results" id="toc-examine-results" class="nav-link" data-scroll-target="#examine-results">Examine Results</a>
  <ul class="collapse">
  <li><a href="#simple-plots" id="toc-simple-plots" class="nav-link" data-scroll-target="#simple-plots">Simple Plots</a></li>
  <li><a href="#wis-scoring" id="toc-wis-scoring" class="nav-link" data-scroll-target="#wis-scoring">WIS Scoring</a></li>
  </ul></li>
  <li><a href="#ensemble" id="toc-ensemble" class="nav-link" data-scroll-target="#ensemble">Ensemble</a>
  <ul class="collapse">
  <li><a href="#historic-forecasts" id="toc-historic-forecasts" class="nav-link" data-scroll-target="#historic-forecasts">Historic Forecasts</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A brief overview of the CovidCAR Package</h1>
</div>

<div>
  <div class="description">
    CovidCAR is intended to facilitate Covid19 model building, ensembling, and evalutaion
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 18, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="tutorial-overview" class="level1">
<h1>Tutorial Overview</h1>
<p>This tutorial briefly outlines core functions used to preprocess observation data, build spatial-temporal models, and post-process model outputs. Its purpose is to demonstrate a standard workflow not to provide an in depth examination of model building techniques.</p>
</section>
<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors

Attaching package: 'arrow'


The following object is masked from 'package:lubridate':

    duration


The following object is masked from 'package:utils':

    timestamp



Attaching package: 'Hmisc'


The following objects are masked from 'package:dplyr':

    src, summarize


The following objects are masked from 'package:base':

    format.pval, units


Linking to GEOS 3.9.3, GDAL 3.5.2, PROJ 8.2.1; sf_use_s2() is TRUE

Loading required package: spData

To access larger datasets in this package, install the spDataLarge
package with: `install.packages('spDataLarge',
repos='https://nowosad.github.io/drat/', type='source')`

rgeos version: 0.6-2, (SVN revision 693)
 GEOS runtime version: 3.9.3-CAPI-1.14.3 
 Please note that rgeos will be retired during 2023,
plan transition to sf functions using GEOS at your earliest convenience.
 GEOS using OverlayNG
 Linking to sp version: 1.6-0 
 Polygon checking: TRUE 



Attaching package: 'rgeos'


The following object is masked from 'package:Hmisc':

    translate


The following object is masked from 'package:dplyr':

    symdiff



Attaching package: 'igraph'


The following object is masked from 'package:rgeos':

    union


The following objects are masked from 'package:lubridate':

    %--%, union


The following objects are masked from 'package:dplyr':

    as_data_frame, groups, union


The following objects are masked from 'package:purrr':

    compose, simplify


The following object is masked from 'package:tidyr':

    crossing


The following object is masked from 'package:tibble':

    as_data_frame


The following object is masked from 'package:cli':

    tree


The following objects are masked from 'package:stats':

    decompose, spectrum


The following object is masked from 'package:base':

    union


Checking rgeos availability: TRUE
Please note that 'maptools' will be retired during 2023,
plan transition at your earliest convenience;
some functionality will be moved to 'sp'.


Attaching package: 'maptools'


The following object is masked from 'package:Hmisc':

    label


Loading required package: maps


Attaching package: 'maps'


The following object is masked from 'package:purrr':

    map



Attaching package: 'censusapi'


The following object is masked from 'package:methods':

    getFunction


Loading required package: Matrix


Attaching package: 'Matrix'


The following objects are masked from 'package:tidyr':

    expand, pack, unpack


Loading required package: foreach


Attaching package: 'foreach'


The following objects are masked from 'package:purrr':

    accumulate, when


Loading required package: parallel

This is INLA_23.04.24 built 2023-04-24 19:15:35 UTC.
 - See www.r-inla.org/contact-us for how to get help.

Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CovidCAR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="setup-analysis" class="level1">
<h1>Setup Analysis</h1>
<section id="specifiy-dates-and-directories" class="level2">
<h2 class="anchored" data-anchor-id="specifiy-dates-and-directories">Specifiy Dates and Directories</h2>
<p>The <em>setup_analysis()</em> function defines key date thresholds for model training and forecast horizon periods and should always be run before using any other functions in the <em>CovidCAR</em> package. The dates are used by other functions to retrieve Covid19 observations (daily hospital incidence) and define points in model the response variable to shift from generating fitted estimates to producing forecast. The model also allow for recording directory paths to (optionally) pull previously cached data and write pipeline outputs.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setup_analysis</span>(<span class="at">report_date =</span> <span class="st">"2021-08-23"</span>, <span class="co">#report date, first forecast day</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">training_period =</span> <span class="dv">2</span><span class="sc">*</span><span class="dv">28</span>, <span class="co">#days</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">forecast_horizon =</span> <span class="dv">28</span>, <span class="co">#days</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">output_dir =</span> <span class="st">"C:/Users/unp7/Desktop/Misc/test_CovidCAR"</span>, <span class="co">#sub directories and outputs written here</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">local_cache_dir =</span> <span class="st">"C:/Users/unp7/Desktop/GitHub/covid19Forecasts/local/cache"</span> <span class="co">#if available</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>→ Your local cache will be available to get_covid19_obs()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ Analysis outputs will be written to C:/Users/unp7/Desktop/Misc/test_CovidCAR/2021-08-23-CovidCAR-run2023-05-19</code></pre>
</div>
</div>
</section>
<section id="define-spatial-domain" class="level2">
<h2 class="anchored" data-anchor-id="define-spatial-domain">Define Spatial Domain</h2>
<p>The <em>download_boundaries()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>States <span class="ot">&lt;-</span> <span class="fu">download_boundaries</span>(<span class="at">unit =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>→ Downloading polygon files...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `us-state-boundaries' from data source 
  `C:\Users\unp7\Desktop\Misc\test_CovidCAR\2021-08-23-CovidCAR-run2023-05-19\polygons' 
  using driver `ESRI Shapefile'
Simple feature collection with 56 features and 20 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -179.2311 ymin: -14.60181 xmax: 179.8597 ymax: 71.44069
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
<section id="adjacency-graph" class="level2">
<h2 class="anchored" data-anchor-id="adjacency-graph">Adjacency Graph</h2>
<p>The <em>get_neighbors()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>nb_islands <span class="ot">=</span> <span class="fu">get_neighbors</span>(States, <span class="at">connect=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nb_islands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 56 
Number of nonzero links: 224 
Percentage nonzero weights: 7.142857 
Average number of links: 4 
7 regions with no links:
1 24 32 33 38 42 54
Link number distribution:

 0  1  2  3  4  5  6  7  8 
 7  1  4  9  9 10 12  2  2 
1 least connected region:
13 with 1 link
2 most connected regions:
49 56 with 8 links</code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>nb_coerced <span class="ot">=</span> <span class="fu">get_neighbors</span>(States, <span class="at">connect=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::mat2listw(edgemat, style = "M"): style is M (missing); style
should be set to a valid value</code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nb_coerced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 56 
Number of nonzero links: 242 
Percentage nonzero weights: 7.716837 
Average number of links: 4.321429 
Link number distribution:

 1  2  3  4  5  6  7  8 
 5  3 10 12 10 11  3  2 
5 least connected regions:
1 13 38 42 54 with 1 link
2 most connected regions:
49 56 with 8 links</code></pre>
</div>
</div>
<p>View mapped adjacency<br>
The <em>plot_neighbors()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_neighbors</span>(States, nb_islands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Regions defined for each Polygons</code></pre>
</div>
<div class="cell-output-display">
<p><img src="CovidCAR-introduction_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_neighbors</span>(States, nb_coerced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Regions defined for each Polygons</code></pre>
</div>
<div class="cell-output-display">
<p><img src="CovidCAR-introduction_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Convert to INLA Graph The <em>nb2INLA()</em> and <em>inla.read.graph()</em> functions</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nb2INLA</span>(<span class="st">"J"</span>, nb_coerced)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>J <span class="ot">=</span> <span class="fu">inla.read.graph</span>(<span class="st">"J"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="retrieve-observation-data" class="level1">
<h1>Retrieve Observation Data</h1>
<p>The <em>get_covid19_obs()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>MinDate <span class="ot">=</span> <span class="fu">min</span>(full_time_span)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>MaxDate <span class="ot">=</span> <span class="fu">max</span>(full_time_span)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#testData = get_covid19_obs(source = "cache", start_date = MinDate, end_date = MaxDate)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>testData <span class="ot">=</span> <span class="fu">get_covid19_obs</span>(<span class="at">source =</span> <span class="st">"covidcast"</span>, <span class="at">start_date =</span> MinDate, <span class="at">end_date =</span> MaxDate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>→ Loading location crosswalk</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 57 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: "|"
chr (4): STATE, STUSAB, STATE_NAME, STATENS

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
→ Fetching COVID-19 observed data from covidcast

Fetched day 2021-06-28 to 2021-09-20: num_entries = 4534</code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#testData = get_covid19_obs(source = "test", start_date = MinDate, end_date = MaxDate)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(testData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4534    5</code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(testData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: right;">value</th>
<th style="text-align: left;">signal</th>
<th style="text-align: left;">location</th>
<th style="text-align: left;">location_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">29</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">01</td>
<td style="text-align: left;">Alabama</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">55</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">05</td>
<td style="text-align: left;">Arkansas</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">75</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">04</td>
<td style="text-align: left;">Arizona</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">201</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">06</td>
<td style="text-align: left;">California</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">08</td>
<td style="text-align: left;">Colorado</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Add Spatial Index<br>
The <em>append_region_index()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">=</span> <span class="fu">append_region_index</span>(<span class="at">train_data =</span> testData, <span class="at">polys =</span> States)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">is.na</span>(train_data<span class="sc">$</span>Region))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
</div>
</section>
<section id="forecast-template" class="level1">
<h1>Forecast Template</h1>
<p>The <em>create_forecast_template()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">=</span> <span class="fu">create_forecast_template</span>(train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="additional-covariates" class="level1">
<h1>Additional Covariates</h1>
<section id="demographic-data" class="level2">
<h2 class="anchored" data-anchor-id="demographic-data">Demographic Data</h2>
<p>The <em>getPovertyPop()</em> function provides a wrapper function for the <a href="https://centeronbudget.github.io/getcensus/"><strong>getCensus</strong> package</a> for loading American Community Survey (ACS) data from the U.S. Census Bureau.</p>
<div class="cell">

</div>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>PovPop_data <span class="ot">=</span> <span class="fu">getPovertyPop</span>(<span class="at">key=</span>secret_api, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">vars_pov =</span> <span class="fu">c</span>(<span class="st">"SAEPOVRTALL_PT"</span>), </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">vars_pop =</span> <span class="fu">c</span>(<span class="st">'AGEGROUP'</span>,<span class="st">'POP'</span>), <span class="at">filt_age =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">18</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">=</span> <span class="fu">left_join</span>(train_data, PovPop_data, <span class="at">by =</span> <span class="st">"location"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="rt-estimation" class="level2">
<h2 class="anchored" data-anchor-id="rt-estimation">Rt Estimation</h2>
<p>The <em>Rt_projection()</em> function combines the <em>estimate_R()</em> function from the <a href="https://github.com/mrc-ide/EpiEstim"><strong>EpiEstim</strong> package</a> with simple timeseries models (options to use the <strong>forecast</strong> or <strong>INLA</strong> packages) to forecast Rt estimated over the model training period over the forecast horizon (28 days in the future). This is just an experimental function. Rather than using forecasted Rt from these runs, models later in this flow will forecast Rt concurrently with hospital incidence (the principal target in this analysis).</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Rt_df <span class="ot">=</span> <span class="fu">Rt_projection</span>(train_data, <span class="at">mean_si =</span> <span class="fl">5.7</span>, <span class="at">std_si =</span> <span class="dv">2</span>, <span class="at">forecast_horizon =</span> <span class="dv">28</span>, <span class="at">method =</span> <span class="st">"dlm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Alaska completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Alabama completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Arkansas completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Arizona completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ California completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Colorado completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Connecticut completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ District of Columbia completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Delaware completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Florida completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Georgia completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Hawaii completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Iowa completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Idaho completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Illinois completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Indiana completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Kansas completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Kentucky completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Louisiana completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Massachusetts completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Maryland completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Maine completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Michigan completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Minnesota completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Missouri completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Mississippi completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Montana completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ North Carolina completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ North Dakota completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Nebraska completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ New Hampshire completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ New Jersey completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ New Mexico completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Nevada completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ New York completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Ohio completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Oklahoma completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Oregon completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Pennsylvania completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Puerto Rico completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in estimate_R_func(incid = incid, method = method, si_sample = si_sample, : You're estimating R too early in the epidemic to get the desired
            posterior CV.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Rhode Island completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ South Carolina completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ South Dakota completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Tennessee completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Texas completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Utah completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Virginia completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in estimate_R_func(incid = incid, method = method, si_sample = si_sample, : You're estimating R too early in the epidemic to get the desired
            posterior CV.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Virgin Islands completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in estimate_R_func(incid = incid, method = method, si_sample = si_sample, : You're estimating R too early in the epidemic to get the desired
            posterior CV.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Vermont completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Washington completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Wisconsin completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ West Virginia completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Wyoming completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ American Samoa completed!</code></pre>
</div>
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Rt_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 14%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: right;">value</th>
<th style="text-align: left;">signal</th>
<th style="text-align: left;">location</th>
<th style="text-align: left;">location_name</th>
<th style="text-align: left;">day</th>
<th style="text-align: left;">trn_tst</th>
<th style="text-align: right;">Region</th>
<th style="text-align: right;">SAEPOVRTALL_PT</th>
<th style="text-align: right;">age_pop</th>
<th style="text-align: right;">Rt_raw</th>
<th style="text-align: right;">Rt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Monday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-06-29</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Tuesday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-06-30</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Wednesday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-07-01</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Thursday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-07-02</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Friday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-07-03</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Saturday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="organize-data" class="level1">
<h1>Organize Data</h1>
<section id="clean-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="clean-dataframe">Clean Dataframe</h2>
<p>The <em>time_index()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Rt_df) <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">s_pop =</span> <span class="fu">log</span>(age_pop),</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">s_pov =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(SAEPOVRTALL_PT)),</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">doy =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(date)),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">doy.1 =</span> doy,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Region.Wk =</span> <span class="fu">paste0</span>(<span class="st">"ID"</span>, Region, <span class="st">"W"</span>, doy),</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID.Region.Wk =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(Region.Wk)),</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">week</span>(date),</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">int_week.1 =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(week)),</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">int_week.2 =</span> int_week<span class="fl">.1</span>,</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">int_week.3 =</span> int_week<span class="fl">.1</span>,</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeday_indx =</span> <span class="fu">time_index</span>(date, <span class="fu">seq</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"3 days"</span>)),</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">threeday_indx.1 =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(threeday_indx)),</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fourday_indx =</span> <span class="fu">time_index</span>(date, <span class="fu">seq</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"4 days"</span>)),</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fourday_indx.1 =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(fourday_indx)),</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fiveday_indx =</span> <span class="fu">time_index</span>(date, <span class="fu">seq</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"5 days"</span>)),</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fiveday_indx.1 =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(fiveday_indx)),</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">eightday_indx =</span> <span class="fu">time_index</span>(date, <span class="fu">seq</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"8 days"</span>)),</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">eightday_indx.1 =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(eightday_indx)),</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">biweek_indx =</span> <span class="fu">time_index</span>(date, <span class="fu">seq</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"14 days"</span>)),</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">biweek_indx.1 =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(biweek_indx)),</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Region.1 =</span> Region, <span class="at">Region.2 =</span> Region, <span class="at">Region.3 =</span> Region, </span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">Region.4 =</span> Region, <span class="at">Region.5 =</span> Region</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="sc">-</span>biweek_indx, threeday_indx, fourday_indx, fiveday_indx, eightday_indx))</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: right;">value</th>
<th style="text-align: left;">signal</th>
<th style="text-align: left;">location</th>
<th style="text-align: left;">location_name</th>
<th style="text-align: left;">day</th>
<th style="text-align: left;">trn_tst</th>
<th style="text-align: right;">Region</th>
<th style="text-align: right;">SAEPOVRTALL_PT</th>
<th style="text-align: right;">age_pop</th>
<th style="text-align: right;">Rt_raw</th>
<th style="text-align: right;">Rt</th>
<th style="text-align: right;">s_pop</th>
<th style="text-align: right;">s_pov</th>
<th style="text-align: right;">doy</th>
<th style="text-align: right;">doy.1</th>
<th style="text-align: left;">Region.Wk</th>
<th style="text-align: right;">ID.Region.Wk</th>
<th style="text-align: right;">week</th>
<th style="text-align: right;">int_week.1</th>
<th style="text-align: right;">int_week.2</th>
<th style="text-align: right;">int_week.3</th>
<th style="text-align: left;">threeday_indx</th>
<th style="text-align: right;">threeday_indx.1</th>
<th style="text-align: left;">fourday_indx</th>
<th style="text-align: right;">fourday_indx.1</th>
<th style="text-align: left;">fiveday_indx</th>
<th style="text-align: right;">fiveday_indx.1</th>
<th style="text-align: left;">eightday_indx</th>
<th style="text-align: right;">eightday_indx.1</th>
<th style="text-align: right;">biweek_indx.1</th>
<th style="text-align: right;">Region.1</th>
<th style="text-align: right;">Region.2</th>
<th style="text-align: right;">Region.3</th>
<th style="text-align: right;">Region.4</th>
<th style="text-align: right;">Region.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Monday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.12772</td>
<td style="text-align: right;">-0.8064822</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">ID38W1</td>
<td style="text-align: right;">2466</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-06-29</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Tuesday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.12772</td>
<td style="text-align: right;">-0.8064822</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">ID38W2</td>
<td style="text-align: right;">2477</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-06-30</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Wednesday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.12772</td>
<td style="text-align: right;">-0.8064822</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">ID38W3</td>
<td style="text-align: right;">2488</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-07-01</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-07-01</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Thursday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.12772</td>
<td style="text-align: right;">-0.8064822</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">ID38W4</td>
<td style="text-align: right;">2499</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2021-07-01</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-02</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-03</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-07-02</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Friday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.12772</td>
<td style="text-align: right;">-0.8064822</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">ID38W5</td>
<td style="text-align: right;">2510</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-01</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-02</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-03</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-06-28</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-07-03</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">hosp</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">Saturday</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">184927</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.12772</td>
<td style="text-align: right;">-0.8064822</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">ID38W6</td>
<td style="text-align: right;">2521</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-04</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">2021-07-02</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-03</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-07-06</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">38</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="code-respone-variable" class="level2">
<h2 class="anchored" data-anchor-id="code-respone-variable">Code Respone Variable</h2>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>resp <span class="ot">=</span> <span class="fu">ifelse</span>(train_data<span class="sc">$</span>trn_tst <span class="sc">==</span> <span class="st">"train"</span>, train_data<span class="sc">$</span>value, <span class="cn">NA</span>) <span class="co">#Set obs value to NA for forecasts periods</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>resp_scale_obj <span class="ot">=</span> <span class="fu">scale</span>(train_data<span class="sc">$</span>resp, <span class="at">scale=</span>T, <span class="at">center=</span>T) <span class="co">#scaled object</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>obs_scale <span class="ot">=</span> <span class="cf">function</span>(r)r<span class="sc">*</span><span class="fu">attr</span>(resp_scale_obj,<span class="st">'scaled:scale'</span>) <span class="sc">+</span> <span class="fu">attr</span>(resp_scale_obj, <span class="st">'scaled:center'</span>) <span class="co">#transform back to observation scale</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>nrm_resp <span class="ot">=</span> <span class="fu">as.numeric</span>(resp_scale_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="format-as-a-datastack" class="level2">
<h2 class="anchored" data-anchor-id="format-as-a-datastack">Format as a Datastack</h2>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>nrm.lst <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">intercept1 =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">dim</span>(train_data)[<span class="dv">1</span>])),</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="at">pov_pct =</span> train_data[,<span class="st">"s_pov"</span>],</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">pop =</span> train_data[,<span class="st">"s_pop"</span>],</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">Rt_raw =</span> train_data[,<span class="st">"Rt_raw"</span>],</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">Rt_raw.1 =</span> train_data[,<span class="st">"Rt_raw"</span>],</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">Rt =</span> train_data[,<span class="st">"Rt"</span>],</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">Rt.1 =</span> train_data[,<span class="st">"Rt"</span>],</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">doy =</span> train_data[,<span class="st">"doy"</span>],</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">doy.1 =</span> train_data[,<span class="st">"doy.1"</span>],</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">doy.2 =</span> train_data[,<span class="st">"doy.1"</span>],</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">int_week.1 =</span> train_data[,<span class="st">"int_week.1"</span>],</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">int_week.2 =</span> train_data[,<span class="st">"int_week.2"</span>],</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">int_week.3 =</span> train_data[,<span class="st">"int_week.3"</span>],</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">threeday_indx.1 =</span> train_data[,<span class="st">"threeday_indx.1"</span>],</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">fourday_indx.1 =</span> train_data[,<span class="st">"fourday_indx.1"</span>],</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">fiveday_indx.1 =</span> train_data[,<span class="st">"fiveday_indx.1"</span>],</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">eightday_indx.1 =</span> train_data[,<span class="st">"eightday_indx.1"</span>],</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">biwek_indx.1 =</span> train_data[,<span class="st">"biweek_indx.1"</span>],</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">Region.1 =</span> train_data[,<span class="st">"Region.1"</span>],</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">Region.2 =</span> train_data[,<span class="st">"Region.2"</span>],</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">Region.3 =</span> train_data[,<span class="st">"Region.3"</span>],</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">Region.4 =</span> train_data[,<span class="st">"Region.4"</span>],</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">Region.5 =</span> train_data[,<span class="st">"Region.5"</span>],</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">Region_Wk =</span> train_data[,<span class="st">"ID.Region.Wk"</span>],</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">dow =</span> train_data[,<span class="st">"day"</span>]))</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>nrm.stk <span class="ot">=</span> <span class="fu">inla.stack</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">Y =</span> train_data<span class="sc">$</span>nrm_resp), </span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>                                <span class="at">effects =</span> nrm.lst,   </span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">tag =</span> <span class="st">"nrm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="model-priors-and-forumulae" class="level1">
<h1>Model Priors and Forumulae</h1>
<section id="set-priors" class="level2">
<h2 class="anchored" data-anchor-id="set-priors">Set Priors</h2>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#bym prior</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>bym_hyper <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">phi =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">"pc"</span>, </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>), </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">initial =</span> <span class="dv">3</span>), </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">"pc.prec"</span>, </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">param =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.01</span>), </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">initial =</span> <span class="fl">1.5</span>))  </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Normal prior</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>norm.prior <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">theta=</span><span class="fu">list</span>(<span class="at">prior =</span> <span class="st">"normal"</span>, <span class="at">param=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="co">#iid prior</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>pc_prec_iid <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">list</span>(<span class="at">prior=</span><span class="st">"pc.prec"</span>, <span class="at">param=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.01</span>)))</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="co">#ar1 prior</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>pc_cor_ar1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'pccor1'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.9</span>)))</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="co">#rw2 prior</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>pc_rw2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">prec=</span><span class="fu">list</span>(<span class="at">prior=</span><span class="st">"pc.prec"</span>, <span class="at">param=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.01</span>)))</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="co">#bundle priors to archive run</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>priors.list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>priors.list[[<span class="st">"bym_hyper"</span>]] <span class="ot">&lt;-</span> bym_hyper</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>priors.list[[<span class="st">"norm.prior"</span>]] <span class="ot">&lt;-</span> norm.prior</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>priors.list[[<span class="st">"pc_prec_iid"</span>]] <span class="ot">&lt;-</span> pc_prec_iid</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>priors.list[[<span class="st">"pc_cor_ar1"</span>]] <span class="ot">&lt;-</span> pc_cor_ar1</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>priors.list[[<span class="st">"pc_rw2"</span>]] <span class="ot">&lt;-</span> pc_rw2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="specify-formulas" class="level2">
<h2 class="anchored" data-anchor-id="specify-formulas">Specify Formulas</h2>
<p>Formula 1: Random Walk plus noise for each location (i.e., state)</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.1</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>     <span class="co">#remove default intercept</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       <span class="co">#custom intercept</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>,           <span class="co">#order by time index (daily)</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,     <span class="co">#enforced zero mean</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"rw1"</span>,     <span class="co">#order-1 random walk with noise</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale.model =</span> <span class="cn">TRUE</span>, <span class="co">#additional internal scaling</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.1</span>, <span class="co">#run rw1 model for groups based on location </span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), <span class="co">#groups are treated independently</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_rw2)  <span class="co">#prior for rw2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Formula 2: Random Walk plus noise and trend for each location</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.2</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>     </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>,           </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,     </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"rw1"</span>,    </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale.model =</span> <span class="cn">TRUE</span>, </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.1</span>, </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), </span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_rw2) <span class="sc">+</span> </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.2</span>, <span class="at">model=</span><span class="st">"linear"</span>, <span class="at">mean.linear =</span> <span class="dv">0</span>, <span class="at">prec.linear =</span> <span class="fl">0.001</span>) <span class="co">#add linear trend to rw1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Formula 3: Common spatial effect for timesteps but each location has separate autoregression</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.3</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>    </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region<span class="fl">.1</span>,        <span class="co">#location index</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"bym2"</span>,    <span class="co">#spatial effect, Besag-York-Mollie model (the 2 indicates scaling) </span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph=</span>J,         <span class="co">#Adjacency graph to identify neighbors</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,     <span class="co">#enforced zero mean</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>bym_hyper) <span class="sc">+</span> <span class="co">#BYM prior</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>,             <span class="co">#order by time index (daily)</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"ar1"</span>,       <span class="co">#apply order-1 autoregressive</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.1</span>,  <span class="co">#run ar1 model for groups based on location</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), <span class="co">#groups are treated independently</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_cor_ar1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Formula 4: Separate spatial effects for timesteps (realted by ar1) and each location has its own autoregressive timetrend</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.4</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>     </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region<span class="fl">.1</span>,        </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"bym2"</span>,   </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph=</span>J,         </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,     </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> doy,     <span class="co">#time index, daily (create separate realizations of spatial covariate for each day)</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"ar1"</span>), <span class="co">#groups are related via an order-1 autoregressive</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>bym_hyper) <span class="sc">+</span> <span class="co">#prior for BYM</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>,             </span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"ar1"</span>,       </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.1</span>,  </span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), </span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_cor_ar1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Formula 5: As Formula 4 but with space-time interaction to capture location and time specific variation outside of modeled trends.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.5</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>    </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region<span class="fl">.1</span>,        </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"bym2"</span>,    </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph=</span>J,         </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,    </span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> doy,     </span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"ar1"</span>),</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>bym_hyper) <span class="sc">+</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>,             </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"ar1"</span>,       </span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.1</span>,  </span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), </span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_cor_ar1) <span class="sc">+</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region_Wk,   <span class="co">#Index for all location*time combinations (space-time interaction)</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"iid"</span>, <span class="co">#each location and time combination considered independently</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_prec_iid) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Formula 6: As Formula 5 but adding covariate for variation due to day of week (e.g.&nbsp;Monday, Tuesday,…Sunday).</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.6</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>    </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region<span class="fl">.1</span>,        </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"bym2"</span>,    </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph=</span>J,         </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,     </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> doy,     </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>bym_hyper, </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"ar1"</span>)) <span class="sc">+</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>,             </span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"ar1"</span>,       </span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.1</span>,  </span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), </span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_cor_ar1) <span class="sc">+</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(dow,           <span class="co">#discrete variable indicating day of week, e.g. Monday, Tuesday,...Sunday</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"iid"</span>,   <span class="co">#days of week may vary independently</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.2</span>, <span class="co">#variation attributed to days of week may differ by location</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), </span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_prec_iid) <span class="sc">+</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region_Wk,   </span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"iid"</span>, </span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_prec_iid) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Formula 7: Including Rt estimates as an experimental covariate. Forecast Rt trend using an autoregressive model.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.7</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>     </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  pov_pct <span class="sc">+</span> pop <span class="sc">+</span>    </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region<span class="fl">.1</span>,        </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"bym2"</span>,    </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph=</span>J,        </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,     </span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> doy,     </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>bym_hyper, </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"ar1"</span>)) <span class="sc">+</span> </span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>, Rt_raw,  <span class="co">#order by time index (daily) but weight each timestep by corresponding Rt_raw estimate</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"ar1"</span>,    <span class="co">#apply order-1 autoregressive to Rt weighted time index above</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.2</span>, </span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>),</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_cor_ar1) <span class="sc">+</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(dow,           </span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"iid"</span>,</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.3</span>,</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>),</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_prec_iid) <span class="sc">+</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region_Wk,   </span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"iid"</span>, </span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_prec_iid) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Formula 8</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>Frm<span class="fl">.8</span> <span class="ot">=</span> Y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>     </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  intercept1 <span class="sc">+</span>       </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  pov_pct <span class="sc">+</span> pop <span class="sc">+</span>    <span class="co">#linear covariates for poverty and population over 55yrs</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region<span class="fl">.1</span>,        </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"bym2"</span>,    </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph=</span>J,        </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,     </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> doy,    </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>bym_hyper, </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"ar1"</span>)) <span class="sc">+</span> </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(threeday_indx<span class="fl">.1</span>, <span class="co">#time index, 3days</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"rw2"</span>,     <span class="co">#order-2 random walk with noise</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale.model =</span> <span class="cn">TRUE</span>,</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.2</span>,</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>), </span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_rw2) <span class="sc">+</span> </span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(doy<span class="fl">.1</span>, Rt_raw,  </span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"ar1"</span>,    </span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.3</span>, </span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>),</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_cor_ar1) <span class="sc">+</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(dow,           </span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"iid"</span>,</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> Region<span class="fl">.4</span>,</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.group=</span><span class="fu">list</span>(<span class="at">model=</span><span class="st">"iid"</span>),</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_prec_iid) <span class="sc">+</span></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(Region_Wk,   </span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">model=</span><span class="st">"iid"</span>, </span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr=</span><span class="cn">TRUE</span>,</span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper=</span>pc_prec_iid) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Organize Formulas</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>formulas.list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"base_rw1"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.1</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"rw1_trend"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.2</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"base_car"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.3</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"car_time"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.4</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"car_sti"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.5</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"car_wdays"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.6</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"car_rt"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.7</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>formulas.list[[<span class="st">"car_full"</span>]] <span class="ot">&lt;-</span> Frm<span class="fl">.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="run-models" class="level1">
<h1>Run Models</h1>
<p>The <em>run_model_list()</em> function</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>formulas.list <span class="ot">=</span> formulas.list[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)] <span class="co">#short list for demo, fast run models</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>models_out <span class="ot">=</span> <span class="fu">run_model_list</span>(<span class="at">formulas.list=</span>formulas.list,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">dataStack=</span>nrm.stk,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">likelihood =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">config=</span><span class="cn">FALSE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Specifying a gaussian likelihood for all models. ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ Running models </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Model base_rw1 completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ Running models </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Model rw1_trend completed!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ Running models </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inla.model.properties.generic(inla.trim.family(model), mm[names(mm) == : Model 'bym2' in section 'latent' is marked as 'experimental'; changes may appear at any time.
  Use this model with extra care!!! Further warnings are disabled.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Model base_car completed!
→ Running models </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ Model car_time completed!</code></pre>
</div>
</div>
</section>
<section id="extract-and-format-forecasts" class="level1">
<h1>Extract and Format Forecasts</h1>
<p>The <em>extract_forecasts()</em> function pulls forecasts from models and saves them to <em>forecasts</em> analysis directory. Returns <em>forecast_paths</em> object with vector of path names.</p>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_forecasts</span>(<span class="at">mod_out=</span>models_out,</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dataStack=</span>nrm.stk, <span class="at">train_data=</span>train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Writing model forecasts to analysis directory: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ base_rw1 [995ms]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Writing model forecasts to analysis directory: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ rw1_trend [1s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Writing model forecasts to analysis directory: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ base_car [1.1s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Writing model forecasts to analysis directory: </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ car_time [1.2s]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
</div>
</section>
<section id="examine-results" class="level1">
<h1>Examine Results</h1>
<div class="cell">
<details open="">
<summary>Hide code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>forecast2 <span class="ot">=</span> <span class="fu">read.csv</span>(forecast_paths[<span class="dv">2</span>])</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(forecast2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 23%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">forecast_date</th>
<th style="text-align: left;">location</th>
<th style="text-align: left;">target</th>
<th style="text-align: left;">target_end_date</th>
<th style="text-align: left;">type</th>
<th style="text-align: right;">quantile</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2021-08-23</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">0 day ahead inc hosp</td>
<td style="text-align: left;">2021-08-23</td>
<td style="text-align: left;">quantile</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">18.093393</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-23</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">1 day ahead inc hosp</td>
<td style="text-align: left;">2021-08-24</td>
<td style="text-align: left;">quantile</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-08-23</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">2 day ahead inc hosp</td>
<td style="text-align: left;">2021-08-25</td>
<td style="text-align: left;">quantile</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-23</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">3 day ahead inc hosp</td>
<td style="text-align: left;">2021-08-26</td>
<td style="text-align: left;">quantile</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">4.850225</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-08-23</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">4 day ahead inc hosp</td>
<td style="text-align: left;">2021-08-27</td>
<td style="text-align: left;">quantile</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">33.667713</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-08-23</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">5 day ahead inc hosp</td>
<td style="text-align: left;">2021-08-28</td>
<td style="text-align: left;">quantile</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">65.695473</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="simple-plots" class="level2">
<h2 class="anchored" data-anchor-id="simple-plots">Simple Plots</h2>
</section>
<section id="wis-scoring" class="level2">
<h2 class="anchored" data-anchor-id="wis-scoring">WIS Scoring</h2>
</section>
</section>
<section id="ensemble" class="level1">
<h1>Ensemble</h1>
<section id="historic-forecasts" class="level2">
<h2 class="anchored" data-anchor-id="historic-forecasts">Historic Forecasts</h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="CovidCAR-introduction_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>